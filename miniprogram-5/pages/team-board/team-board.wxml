<view class="team-page">
  <view class="page-header">
    <view class="header-left">
      <view class="back-button" bindtap="goBack">
        <van-icon name="arrow-left" size="40rpx" color="#323233" />
      </view>
      <text class="header-title">团队任务</text>
    </view>
    <view class="header-right">
      <text class="header-score">{{summary.totalTeamScore || 0}}</text>
      <text class="header-label">累计得分</text>
    </view>
  </view>

  <view class="summary-card">
    <view class="summary-item">
      <text class="summary-label">平均贡献度</text>
      <text class="summary-value">{{summary.averageContribution || 0}}%</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">团队任务数</text>
      <text class="summary-value">{{summary.totalTasks || 0}}</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">领先团队</text>
      <text class="summary-value">{{summary.topTeamName || '待定'}}</text>
    </view>
  </view>

  <block wx:if="{{loading}}">
    <view class="state-block">
      <van-loading size="32px" color="#1989fa" />
      <text class="state-text">看板加载中...</text>
    </view>
  </block>

  <block wx:elif="{{error}}">
    <view class="state-block error">
      <text class="state-text">{{error}}</text>
      <view class="retry-button" bindtap="retryFetch">重新加载</view>
    </view>
  </block>

  <block wx:else>
    <block wx:if="{{teamTasks.length}}">
      <view class="task-list">
        <view class="task-card" wx:for="{{teamTasks}}" wx:key="taskId">
          <view class="task-header">
            <view class="task-title-wrapper">
              <text class="task-title">{{item.taskName}}</text>
              <van-tag type="primary" size="medium">{{item.teamName}}</van-tag>
            </view>
            <text class="task-course">{{item.courseTitle}}</text>
          </view>

          <view class="task-desc">{{item.description}}</view>

          <view class="metrics-grid">
            <view class="metric-item">
              <view class="metric-icon-wrapper">
                <van-icon name="clock-o" size="32rpx" color="#1989fa" />
              </view>
              <view class="metric-content">
                <text class="metric-label">截止日期</text>
                <text class="metric-value">{{item.deadline || '待定'}}</text>
              </view>
            </view>

            <view class="metric-item">
              <view class="metric-icon-wrapper">
                <van-icon name="friends-o" size="32rpx" color="#7232dd" />
              </view>
              <view class="metric-content">
                <text class="metric-label">提交情况</text>
                <text class="metric-value">{{item.submittedMembers}}/{{item.totalMembers}}</text>
              </view>
            </view>

            <view class="metric-item">
              <view class="metric-content">
                <text class="metric-label">提交率</text>
                <text class="metric-value green">{{item.submitRate}}%</text>
              </view>
            </view>

            <view class="metric-item">
              <view class="metric-content">
                <text class="metric-label">热度指数</text>
                <text class="metric-value orange">{{item.popularityIndex}}</text>
              </view>
            </view>
          </view>

          <view class="team-metrics">
            <view class="team-metric-item">
              <text class="team-metric-label">团队得分</text>
              <text class="team-metric-value highlight">{{item.teamScore}}</text>
            </view>
            <view class="team-metric-item">
              <text class="team-metric-label">团队排名</text>
              <text class="team-metric-value">{{item.teamRank}}</text>
            </view>
            <view class="team-metric-item">
              <text class="team-metric-label">个人贡献度</text>
              <text class="team-metric-value">{{item.individualContribution}}%</text>
            </view>
          </view>

          <view class="task-footer">
            <text class="footer-updated">最近更新 {{summary.updatedAt || ''}}</text>
          </view>
        </view>
      </view>
    </block>
    <block wx:else>
      <van-empty description="暂无团队任务"></van-empty>
    </block>
  </block>
</view>

