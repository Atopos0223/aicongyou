<view class="personal-tasks-container">
  <!-- 搜索栏 -->
  <view class="search-section">
    <van-search
      value="{{searchValue}}"
      placeholder="搜索任务名称或描述"
      bind:search="onSearch"
      bind:clear="onClearSearch"
    />
  </view>

  <!-- 标签页 -->
  <van-tabs active="{{activeTab}}" bind:change="onTabChange">
    <van-tab wx:for="{{tabs}}" wx:key="index" title="{{item}}">
      <view class="tab-content">
        <!-- 加载状态 -->
        <view wx:if="{{loading}}" class="loading-state">
          <van-loading size="24px" vertical>加载中...</van-loading>
        </view>

        <!-- 任务列表 -->
        <view wx:else class="task-list">
          <view wx:for="{{filteredTasks}}" wx:key="id" class="task-card">
            <!-- 任务头部 -->
            <view class="task-header">
              <view class="task-title-section">
                <text class="task-name">{{item.name}}</text>
                <van-tag 
                  size="small" 
                  color="{{item.tagColor}}"
                >
                  {{item.statusText}}
                  {{item.isOverdue ? '(已逾期)' : ''}}
                </van-tag>
              </view>
              <text class="task-type" style="color: {{item.typeColor}}">
                {{item.type}}
              </text>
            </view>

            <!-- 任务描述 -->
            <text class="task-desc">{{item.desc}}</text>

            <!-- 进度条 -->
            <view class="progress-section">
              <view class="progress-info">
                <text class="progress-text">完成进度</text>
                <text class="progress-percent">{{item.progress}}%</text>
              </view>
              <van-progress 
                percentage="{{item.progress}}" 
                stroke-width="6" 
                color="{{item.isOverdue ? '#ff4444' : '#07c160'}}"
              />
            </view>

            <!-- 任务信息 -->
            <view class="task-meta">
              <view class="meta-item">
                <van-icon name="clock-o" size="12px" color="#999" />
                <text class="meta-text">截止: {{item.deadline}}</text>
              </view>
              <view class="meta-item">
                <van-icon name="bar-chart-o" size="12px" color="#999" />
                <text class="meta-text">提交率: {{item.submitRate}}%</text>
              </view>
              <view class="meta-item">
                <van-icon name="fire-o" size="12px" color="#999" />
                <text class="meta-text">热度: {{item.popularity}}</text>
              </view>
            </view>

            <!-- 分数显示 -->
            <view wx:if="{{item.score}}" class="score-section">
              <text class="score-text">得分: {{item.score}}</text>
            </view>

            <!-- 操作按钮 -->
            <view class="action-buttons">
              <van-button 
                size="small" 
                type="primary" 
                bindtap="viewTaskDetail" 
                data-id="{{item.id}}"
              >
                查看详情
              </van-button>
              <van-button 
                wx:if="{{item.studentStatus === 1}}"
                size="small" 
                type="warning" 
                bindtap="submitTask" 
                data-id="{{item.id}}"
              >
                提交作业
              </van-button>
              <van-button 
                wx:if="{{item.studentStatus === 2}}"
                size="small" 
                type="success" 
                disabled
              >
                已提交
              </van-button>
            </view>
          </view>

          <!-- 空状态 -->
          <view wx:if="{{!loading && filteredTasks.length === 0}}" class="empty-state">
            <van-empty description="暂无任务">
              <van-button round type="primary" bindtap="loadPersonalTasks">
                重新加载
              </van-button>
            </van-empty>
          </view>
        </view>
      </view>
    </van-tab>
  </van-tabs>

  <!-- 返回按钮 -->
  <view class="floating-action">
    <van-button type="default" round bindtap="goBack" icon="arrow-left">
      返回
    </van-button>
  </view>
</view>