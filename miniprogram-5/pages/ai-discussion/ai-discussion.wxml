<view class="chat-page">
  <!-- 顶部导航栏 -->
  <view class="chat-header">
    <view class="header-back" bindtap="goBack">
      <van-icon name="arrow-left" size="40rpx" color="#323233" />
    </view>
    <view class="header-title">AI讨论:{{taskName}}</view>
    <view class="header-translate" bindtap="toggleTranslate">
      <view class="translate-icon">译</view>
    </view>
  </view>

  <!-- 消息列表 -->
  <scroll-view 
    class="chat-messages" 
    scroll-y 
    scroll-into-view="{{scrollIntoView}}"
    scroll-with-animation
    enable-back-to-top>
    <view class="messages-container">
      <view 
        class="message-item {{item.type === 'user' ? 'message-user' : 'message-ai'}}" 
        wx:for="{{messages}}" 
        wx:key="id"
        id="msg-{{item.id}}">
        
        <!-- AI消息 -->
        <view wx:if="{{item.type === 'ai'}}" class="message-content message-ai-content">
          <view class="message-avatar">
            <view class="ai-logo">AI</view>
          </view>
          <view class="message-wrapper">
            <view class="message-label">AI助手</view>
            <view class="message-bubble ai-bubble">
              <text class="message-text" user-select>{{item.content}}</text>
            </view>
          </view>
        </view>

        <!-- 用户消息 -->
        <view wx:if="{{item.type === 'user'}}" class="message-content message-user-content">
          <view class="message-wrapper">
            <view class="message-bubble user-bubble">
              <text class="message-text" user-select>{{item.content}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- AI正在输入提示 -->
      <view wx:if="{{isLoading}}" class="message-item message-ai">
        <view class="message-content message-ai-content">
          <view class="message-avatar">
            <view class="ai-logo">AI</view>
          </view>
          <view class="message-wrapper">
            <view class="message-label">AI助手</view>
            <view class="message-bubble ai-bubble typing-indicator">
              <view class="typing-dots">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部输入栏 -->
  <view class="chat-input-bar">
    <view class="input-wrapper">
      <input 
        class="chat-input" 
        type="text" 
        placeholder="输入你的问题..." 
        value="{{inputValue}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        confirm-type="send"
        maxlength="500" />
      <view class="send-button {{inputValue.trim() ? 'send-button-active' : ''}}" bindtap="sendMessage">
        <view class="send-icon">✈</view>
      </view>
    </view>
  </view>
</view>

